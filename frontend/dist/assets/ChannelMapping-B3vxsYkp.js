import{_ as le,u as oe,g as ie,r as p,h as ue,o as re,c as t,b as e,d as _,q as A,t as i,F as g,l as b,n as h,w as P,e as v,v as k,E as B,s as w,p as z,x as de,f as l}from"./index-BCRoANWK.js";const pe={class:"card-header",style:{"margin-bottom":"16px"}},ve={class:"card-title"},ce={class:"header-actions"},me={key:0,class:"status-badge active"},ge={key:1,class:"status-badge"},be={class:"mapping-configs"},he={class:"configs-list"},fe={class:"config-info"},_e={class:"config-name"},ye={class:"config-count"},Ce={class:"config-actions"},ke=["onClick"],Me=["onClick"],we=["onClick"],Ue={key:0,class:"no-configs"},Se={class:"modal-header"},De={class:"modal-title"},xe={class:"editor-content"},Ve={class:"editor-top"},$e={class:"form-group"},Te={class:"form-group"},Ee={class:"form-label"},Pe={style:{color:"var(--text-secondary)"}},Oe={class:"radio-group"},Ne={class:"edit-mode-tabs"},Ae={key:0,class:"table-editor"},Fe={class:"table-container"},He={class:"mapping-table"},Be=["onUpdate:modelValue"],ze=["value"],Ie=["onUpdate:modelValue"],Le=["onUpdate:modelValue"],Re=["value"],je=["onUpdate:modelValue"],Je=["onClick"],We={key:1,class:"bulk-editor"},Xe={class:"bulk-form"},qe={class:"bulk-row"},Ge={class:"form-group"},Ye=["value"],Ke={class:"form-group"},Qe={class:"form-group"},Ze={class:"bulk-row"},ea={class:"form-group"},aa=["value"],na={class:"form-group"},sa={class:"form-group bulk-preview"},ta={class:"preview-text"},la={key:2,class:"visual-editor"},oa={class:"visual-controls"},ia={class:"visual-control-group"},ua=["value"],ra={class:"visual-control-group"},da=["value"],pa={class:"visual-control-group"},va={class:"visual-grids"},ca={class:"visual-grid-section"},ma=["onDragstart"],ga={class:"visual-grid-section"},ba=["onDragover","onDrop"],ha={class:"mappings-summary"},fa={key:0,class:"summary-list"},_a=["onClick"],ya={key:0,class:"more-count"},Ca={key:1,class:"no-mappings"},ka={class:"modal-footer"},Ma=["disabled"],wa={class:"modal"},Ua={class:"modal-header"},Sa={class:"modal-footer"},Da={class:"modal",style:{"max-width":"650px"}},xa={class:"modal-header"},Va={class:"modal-footer"},$a={__name:"ChannelMapping",setup(Ta){const I=oe(),F=ie(),O=p([]),N=p({enabled:!1,mapping_count:0}),c=p([]),U=p(!1),$=p(!1),y=p(null),m=p("table"),o=p({name:"",unmapped_behavior:"passthrough",mappings:[]}),u=p({src_universe:1,src_start:1,src_end:16,dst_universe:1,dst_start:1}),S=p(1),D=p(1),T=p(32),C=p(null),x=p(null),f=p(null),L=ue(()=>{const s=u.value.src_end-u.value.src_start;return u.value.dst_start+s});async function M(s,a={}){return a.headers={...a.headers,...I.getAuthHeaders()},fetch(s,a)}async function V(){try{const a=await(await M("/api/mapping")).json();O.value=a.mappings||[],N.value=a.status||{enabled:!1}}catch(s){console.error("Failed to load mappings:",s)}}async function R(){await F.loadUniverses(),c.value=F.universes,c.value.length>0&&(S.value=c.value[0].id,D.value=c.value[0].id,u.value.src_universe=c.value[0].id,u.value.dst_universe=c.value[0].id)}function j(){y.value=null,o.value={name:"",unmapped_behavior:"passthrough",mappings:[]},m.value="table",$.value=!0}function J(s){console.log("editMapping called with:",JSON.stringify(s,null,2)),y.value=s,o.value={name:s.name,unmapped_behavior:s.unmapped_behavior,mappings:[...s.mappings]},console.log("editorForm.unmapped_behavior set to:",o.value.unmapped_behavior),m.value="table",$.value=!0}function E(){$.value=!1,y.value=null}async function W(){var s;if(o.value.name)try{const a={name:o.value.name,enabled:((s=y.value)==null?void 0:s.enabled)||!1,unmapped_behavior:o.value.unmapped_behavior,mappings:o.value.mappings};console.log("Saving mapping with payload:",JSON.stringify(a,null,2));const n=y.value?`/api/mapping/${y.value.id}`:"/api/mapping",d=y.value?"PUT":"POST";(await M(n,{method:d,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok&&(E(),await V())}catch(a){console.error("Failed to save mapping:",a)}}async function X(s){try{s.enabled?await M("/api/mapping/disable",{method:"POST"}):await M(`/api/mapping/${s.id}/enable`,{method:"POST"}),await V()}catch(a){console.error("Failed to toggle mapping:",a)}}async function q(){try{const a=await(await M("/api/mapping/sync",{method:"POST"})).json();console.log("Sync result:",a),await V()}catch(s){console.error("Failed to sync mapping:",s)}}function G(s){f.value=s}async function Y(){if(f.value)try{await M(`/api/mapping/${f.value.id}`,{method:"DELETE"}),f.value=null,await V()}catch(s){console.error("Failed to delete mapping:",s)}}function K(){var a;const s=((a=c.value[0])==null?void 0:a.id)||1;o.value.mappings.push({src_universe:s,src_channel:1,dst_universe:s,dst_channel:1})}function H(s){o.value.mappings.splice(s,1)}function Q(){o.value.mappings=[]}function Z(){const s=u.value.src_end-u.value.src_start+1;for(let a=0;a<s;a++)o.value.mappings.push({src_universe:u.value.src_universe,src_channel:u.value.src_start+a,dst_universe:u.value.dst_universe,dst_channel:u.value.dst_start+a})}function ee(s,a){return o.value.mappings.some(n=>n.src_universe===s&&n.src_channel===a)}function ae(s,a){return o.value.mappings.some(n=>n.dst_universe===s&&n.dst_channel===a)}function ne(s){C.value={universe:S.value,channel:s}}function se(){C.value=null,x.value=null}function te(s){C.value&&o.value.mappings.push({src_universe:C.value.universe,src_channel:C.value.channel,dst_universe:D.value,dst_channel:s}),C.value=null,x.value=null}return re(()=>{V(),R()}),(s,a)=>(l(),t("div",null,[e("div",pe,[e("h2",ve,[a[22]||(a[22]=A("Channel Mapping ",-1)),e("button",{class:"btn btn-small btn-secondary help-btn",onClick:a[0]||(a[0]=n=>U.value=!0),title:"How channel mapping works"},"?")]),e("div",ce,[N.value.enabled?(l(),t("span",me," Mapping Active ("+i(N.value.unmapped_behavior==="passthrough"?"Passthrough":"Ignore")+") ",1)):(l(),t("span",ge,"Mapping Disabled")),e("button",{class:"btn btn-small btn-secondary",onClick:q,title:"Force sync runtime from database"},"Sync")])]),e("div",be,[e("div",{class:"configs-header"},[a[23]||(a[23]=e("h3",null,"Saved Mappings",-1)),e("button",{class:"btn btn-primary btn-small",onClick:j},"+ New Mapping")]),e("div",he,[(l(!0),t(g,null,b(O.value,n=>(l(),t("div",{key:n.id,class:h(["config-card",{active:n.enabled}])},[e("div",fe,[e("span",_e,i(n.name),1),e("span",ye,i(n.mappings.length)+" mappings",1)]),e("div",Ce,[e("button",{class:h(["btn btn-small",n.enabled?"btn-success":"btn-secondary"]),onClick:d=>X(n)},i(n.enabled?"Active":"Enable"),11,ke),e("button",{class:"btn btn-small btn-secondary",onClick:d=>J(n)},"Edit",8,Me),e("button",{class:"btn btn-small btn-danger",onClick:d=>G(n)},"Delete",8,we)])],2))),128)),O.value.length===0?(l(),t("div",Ue," No mapping configurations yet. Create one to get started. ")):_("",!0)])]),$.value?(l(),t("div",{key:0,class:"modal-overlay",onClick:P(E,["self"])},[e("div",{class:h(["modal modal-large",{"modal-visual":m.value==="visual"}])},[e("div",Se,[e("h3",De,i(y.value?"Edit Mapping":"Create Mapping"),1),e("button",{class:"modal-close",onClick:E},"×")]),e("div",xe,[e("div",Ve,[e("div",$e,[a[24]||(a[24]=e("label",{class:"form-label"},"Mapping Name",-1)),v(e("input",{type:"text",class:"form-input","onUpdate:modelValue":a[1]||(a[1]=n=>o.value.name=n),placeholder:"e.g., Console to Faders"},null,512),[[k,o.value.name]])]),e("div",Te,[e("label",Ee,[a[25]||(a[25]=A("Unmapped Channel Behavior ",-1)),e("small",Pe,"(current: "+i(o.value.unmapped_behavior)+")",1)]),e("div",Oe,[e("label",{class:h(["radio-option",{selected:o.value.unmapped_behavior==="passthrough"}])},[v(e("input",{type:"radio","onUpdate:modelValue":a[2]||(a[2]=n=>o.value.unmapped_behavior=n),value:"passthrough"},null,512),[[B,o.value.unmapped_behavior]]),a[26]||(a[26]=e("span",null,"Pass through 1:1",-1))],2),e("label",{class:h(["radio-option",{selected:o.value.unmapped_behavior==="ignore"}])},[v(e("input",{type:"radio","onUpdate:modelValue":a[3]||(a[3]=n=>o.value.unmapped_behavior=n),value:"ignore"},null,512),[[B,o.value.unmapped_behavior]]),a[27]||(a[27]=e("span",null,"Ignore (zero output)",-1))],2)])])]),e("div",Ne,[e("button",{class:h(["tab-btn",{active:m.value==="table"}]),onClick:a[4]||(a[4]=n=>m.value="table")}," Table Editor ",2),e("button",{class:h(["tab-btn",{active:m.value==="bulk"}]),onClick:a[5]||(a[5]=n=>m.value="bulk")}," Bulk Range ",2),e("button",{class:h(["tab-btn",{active:m.value==="visual"}]),onClick:a[6]||(a[6]=n=>m.value="visual")}," Visual ",2)]),m.value==="table"?(l(),t("div",Ae,[e("div",Fe,[e("table",He,[a[28]||(a[28]=e("thead",null,[e("tr",null,[e("th",null,"Source Universe"),e("th",null,"Source Channel"),e("th",null,"Dest Universe"),e("th",null,"Dest Channel"),e("th")])],-1)),e("tbody",null,[(l(!0),t(g,null,b(o.value.mappings,(n,d)=>(l(),t("tr",{key:d},[e("td",null,[v(e("select",{class:"form-select","onUpdate:modelValue":r=>n.src_universe=r},[(l(!0),t(g,null,b(c.value,r=>(l(),t("option",{key:r.id,value:r.id},i(r.label),9,ze))),128))],8,Be),[[w,n.src_universe,void 0,{number:!0}]])]),e("td",null,[v(e("input",{type:"number",class:"form-input","onUpdate:modelValue":r=>n.src_channel=r,min:"1",max:"512"},null,8,Ie),[[k,n.src_channel,void 0,{number:!0}]])]),e("td",null,[v(e("select",{class:"form-select","onUpdate:modelValue":r=>n.dst_universe=r},[(l(!0),t(g,null,b(c.value,r=>(l(),t("option",{key:r.id,value:r.id},i(r.label),9,Re))),128))],8,Le),[[w,n.dst_universe,void 0,{number:!0}]])]),e("td",null,[v(e("input",{type:"number",class:"form-input","onUpdate:modelValue":r=>n.dst_channel=r,min:"1",max:"512"},null,8,je),[[k,n.dst_channel,void 0,{number:!0}]])]),e("td",null,[e("button",{class:"btn btn-small btn-danger",onClick:r=>H(d)},"X",8,Je)])]))),128))])])]),e("button",{class:"btn btn-secondary",onClick:K},"+ Add Mapping")])):_("",!0),m.value==="bulk"?(l(),t("div",We,[e("div",Xe,[e("div",qe,[e("div",Ge,[a[29]||(a[29]=e("label",{class:"form-label"},"Source Universe",-1)),v(e("select",{class:"form-select","onUpdate:modelValue":a[7]||(a[7]=n=>u.value.src_universe=n)},[(l(!0),t(g,null,b(c.value,n=>(l(),t("option",{key:n.id,value:n.id},i(n.label),9,Ye))),128))],512),[[w,u.value.src_universe,void 0,{number:!0}]])]),e("div",Ke,[a[30]||(a[30]=e("label",{class:"form-label"},"Start Channel",-1)),v(e("input",{type:"number",class:"form-input","onUpdate:modelValue":a[8]||(a[8]=n=>u.value.src_start=n),min:"1",max:"512"},null,512),[[k,u.value.src_start,void 0,{number:!0}]])]),e("div",Qe,[a[31]||(a[31]=e("label",{class:"form-label"},"End Channel",-1)),v(e("input",{type:"number",class:"form-input","onUpdate:modelValue":a[9]||(a[9]=n=>u.value.src_end=n),min:"1",max:"512"},null,512),[[k,u.value.src_end,void 0,{number:!0}]])])]),e("div",Ze,[e("div",ea,[a[32]||(a[32]=e("label",{class:"form-label"},"Destination Universe",-1)),v(e("select",{class:"form-select","onUpdate:modelValue":a[10]||(a[10]=n=>u.value.dst_universe=n)},[(l(!0),t(g,null,b(c.value,n=>(l(),t("option",{key:n.id,value:n.id},i(n.label),9,aa))),128))],512),[[w,u.value.dst_universe,void 0,{number:!0}]])]),e("div",na,[a[33]||(a[33]=e("label",{class:"form-label"},"Start Channel",-1)),v(e("input",{type:"number",class:"form-input","onUpdate:modelValue":a[11]||(a[11]=n=>u.value.dst_start=n),min:"1",max:"512"},null,512),[[k,u.value.dst_start,void 0,{number:!0}]])]),e("div",sa,[a[34]||(a[34]=e("label",{class:"form-label"},"Preview",-1)),e("span",ta,i(u.value.src_start)+"-"+i(u.value.src_end)+" -> "+i(u.value.dst_start)+"-"+i(L.value),1)])]),e("button",{class:"btn btn-primary",onClick:Z},"Add Range to Mappings")])])):_("",!0),m.value==="visual"?(l(),t("div",la,[e("div",oa,[e("div",ia,[a[35]||(a[35]=e("label",null,"Source Universe",-1)),v(e("select",{class:"form-select","onUpdate:modelValue":a[12]||(a[12]=n=>S.value=n)},[(l(!0),t(g,null,b(c.value,n=>(l(),t("option",{key:n.id,value:n.id},i(n.label),9,ua))),128))],512),[[w,S.value,void 0,{number:!0}]])]),e("div",ra,[a[36]||(a[36]=e("label",null,"Destination Universe",-1)),v(e("select",{class:"form-select","onUpdate:modelValue":a[13]||(a[13]=n=>D.value=n)},[(l(!0),t(g,null,b(c.value,n=>(l(),t("option",{key:n.id,value:n.id},i(n.label),9,da))),128))],512),[[w,D.value,void 0,{number:!0}]])]),e("div",pa,[a[37]||(a[37]=e("label",null,"Channels per row",-1)),v(e("input",{type:"number",class:"form-input","onUpdate:modelValue":a[14]||(a[14]=n=>T.value=n),min:"8",max:"64",step:"1"},null,512),[[k,T.value,void 0,{number:!0}]])])]),e("div",va,[e("div",ca,[a[38]||(a[38]=e("h4",null,"Source Channels (drag from)",-1)),e("div",{class:"channel-grid",style:z({gridTemplateColumns:`repeat(${T.value}, 1fr)`})},[(l(),t(g,null,b(512,n=>{var d;return e("div",{key:"src-"+n,class:h(["channel-cell source",{mapped:ee(S.value,n),dragging:((d=C.value)==null?void 0:d.channel)===n}]),draggable:"true",onDragstart:r=>ne(n),onDragend:se},i(n),43,ma)}),64))],4)]),e("div",ga,[a[39]||(a[39]=e("h4",null,"Destination Channels (drop onto)",-1)),e("div",{class:"channel-grid",style:z({gridTemplateColumns:`repeat(${T.value}, 1fr)`})},[(l(),t(g,null,b(512,n=>e("div",{key:"dst-"+n,class:h(["channel-cell destination",{mapped:ae(D.value,n),dragover:x.value===n}]),onDragover:P(d=>x.value=n,["prevent"]),onDragleave:a[15]||(a[15]=d=>x.value=null),onDrop:d=>te(n)},i(n),43,ba)),64))],4)])])])):_("",!0),e("div",ha,[e("h4",null,"Current Mappings ("+i(o.value.mappings.length)+")",1),o.value.mappings.length>0?(l(),t("div",fa,[(l(!0),t(g,null,b(o.value.mappings.slice(0,20),(n,d)=>(l(),t("span",{key:d,class:"mapping-chip"},[A(" U"+i(n.src_universe)+"."+i(n.src_channel)+" -> U"+i(n.dst_universe)+"."+i(n.dst_channel)+" ",1),e("button",{class:"chip-remove",onClick:r=>H(d)},"×",8,_a)]))),128)),o.value.mappings.length>20?(l(),t("span",ya," +"+i(o.value.mappings.length-20)+" more ",1)):_("",!0)])):(l(),t("div",Ca,"No mappings defined yet.")),o.value.mappings.length>0?(l(),t("button",{key:2,class:"btn btn-small btn-danger",onClick:Q},"Clear All")):_("",!0)])]),e("div",ka,[e("button",{class:"btn btn-secondary",onClick:E},"Cancel"),e("button",{class:"btn btn-primary",onClick:W,disabled:!o.value.name},"Save",8,Ma)])],2)])):_("",!0),f.value?(l(),t("div",{key:1,class:"modal-overlay",onClick:a[18]||(a[18]=P(n=>f.value=null,["self"]))},[e("div",wa,[e("div",Ua,[a[40]||(a[40]=e("h3",{class:"modal-title"},"Delete Mapping",-1)),e("button",{class:"modal-close",onClick:a[16]||(a[16]=n=>f.value=null)},"×")]),e("p",null,'Are you sure you want to delete "'+i(f.value.name)+'"?',1),e("div",Sa,[e("button",{class:"btn btn-secondary",onClick:a[17]||(a[17]=n=>f.value=null)},"Cancel"),e("button",{class:"btn btn-danger",onClick:Y},"Delete")])])])):_("",!0),U.value?(l(),t("div",{key:2,class:"modal-overlay",onClick:a[21]||(a[21]=P(n=>U.value=!1,["self"]))},[e("div",Da,[e("div",xa,[a[41]||(a[41]=e("h3",{class:"modal-title"},"How Channel Mapping Works",-1)),e("button",{class:"modal-close",onClick:a[19]||(a[19]=n=>U.value=!1)},"×")]),a[42]||(a[42]=de('<div class="help-content" data-v-f54a5122><p class="help-intro" data-v-f54a5122>Channel mapping routes input channels to different output channels. This is useful for remapping console faders, combining inputs, or reorganizing your DMX layout.</p><div class="help-section" data-v-f54a5122><h4 data-v-f54a5122>Mapped Channels</h4><p data-v-f54a5122>Input channels with mappings <strong data-v-f54a5122>only</strong> go to their mapped destination(s). They do NOT also pass through 1:1.</p><p class="help-example" data-v-f54a5122>Example: Ch1 → Ch12 means input Ch1 controls output Ch12. Output Ch1 is not affected by input Ch1.</p></div><div class="help-section" data-v-f54a5122><h4 data-v-f54a5122>One-to-Many Mapping</h4><p data-v-f54a5122>A single input channel can map to multiple output channels.</p><p class="help-example" data-v-f54a5122>Example: Ch1 → Ch10, Ch11, Ch12 means input Ch1 controls all three output channels simultaneously.</p></div><div class="help-section" data-v-f54a5122><h4 data-v-f54a5122>Unmapped Channel Behavior</h4><div class="help-option" data-v-f54a5122><span class="help-option-label" data-v-f54a5122>Pass through 1:1</span><p data-v-f54a5122>Channels without mappings pass through normally (input Ch5 → output Ch5). Mapped destinations are protected from being overwritten.</p></div><div class="help-option" data-v-f54a5122><span class="help-option-label" data-v-f54a5122>Ignore (zero output)</span><p data-v-f54a5122>Only mapped channels produce output. All unmapped input channels are ignored.</p></div></div><div class="help-section" data-v-f54a5122><h4 data-v-f54a5122>Merge Modes (HTP/LTP)</h4><p data-v-f54a5122>The merge mode (configured in Input/Output) applies to the <strong data-v-f54a5122>destination</strong> channels after mapping.</p><ul data-v-f54a5122><li data-v-f54a5122><strong data-v-f54a5122>HTP (Highest Takes Precedence)</strong>: Highest value between local faders and mapped input wins</li><li data-v-f54a5122><strong data-v-f54a5122>LTP (Latest Takes Precedence)</strong>: Most recent change wins (mapped input overrides local faders)</li></ul></div><div class="help-section" data-v-f54a5122><h4 data-v-f54a5122>Cross-Universe Mapping</h4><p data-v-f54a5122>You can map input from one universe to output channels in a different universe.</p><p class="help-example" data-v-f54a5122>Example: Universe 1 Ch1 → Universe 2 Ch1 routes input from universe 1 to output on universe 2.</p></div></div>',1)),e("div",Va,[e("button",{class:"btn btn-primary",onClick:a[20]||(a[20]=n=>U.value=!1)},"Got it")])])])):_("",!0)]))}},Pa=le($a,[["__scopeId","data-v-f54a5122"]]);export{Pa as default};
