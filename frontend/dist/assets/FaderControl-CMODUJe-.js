import{_ as ve,g as de,r as i,h as E,i as fe,j as a,o as pe,k as me,c,b as o,d as Z,e as he,v as ge,F as U,l as w,n as f,m as T,t as p,w as Ce,p as G,f as v}from"./index-BCRoANWK.js";const _e={class:"fader-header"},be={class:"header-top"},ye={class:"header-right"},ke={class:"per-page-control"},xe={class:"universe-tabs"},Ue=["onClick"],we={class:"jump-popup"},Te={class:"jump-popup-header"},Ae={class:"jump-popup-list"},Me=["onClick"],Se={class:"card",style:{"margin-bottom":"16px",padding:"12px"}},Ve={style:{display:"flex",gap:"8px","align-items":"center","flex-wrap":"wrap"}},Le=["onClick"],$e={class:"card",style:{"overflow-x":"auto"}},De={class:"fader-grid"},Ee={class:"fader-indicators"},Ge=["title"],Ie=["title"],Re=["onClick"],Fe=["onMousedown","onTouchstart"],Pe=["onClick"],je={class:"fader-value"},Be={class:"fader-percent"},Ne={class:"fader-raw"},ze={class:"card",style:{"margin-top":"16px",padding:"12px"}},Xe={style:{display:"flex",gap:"8px","flex-wrap":"wrap"}},Ye={__name:"FaderControl",setup(qe){const s=de(),r=i(new Array(512).fill(0)),I=i(new Array(512).fill(0)),m=i({start:1,end:64}),_=i(null),d=i(parseInt(localStorage.getItem("dmxx_channelsPerPage"))||64),b=i({}),u=i({}),h=i({}),R=i(new Array(512).fill(0));let y=null,k=[],A=null;const g=i(!1),M=i({});let S=null;const F=E(()=>{const e=[];for(let t=1;t<=512;t+=d.value){const n=Math.min(t+d.value-1,512);e.push({start:t,end:n})}return e});fe(d,e=>{e<1?d.value=1:e>512&&(d.value=512),localStorage.setItem("dmxx_channelsPerPage",d.value.toString()),m.value=F.value[0]});const V=E(()=>{const e=[];for(let t=m.value.start;t<=m.value.end;t++)e.push(t);return e}),L=E(()=>a.blackoutActive.value?new Array(512).fill(0):r.value);pe(async()=>{await s.loadChannelLabels(s.currentUniverse),a.on("channel_change",B),a.on("values",N),a.on("all_values",z),a.on("input_to_ui",X),a.on("blackout",Y),P(),a.requestValues(s.currentUniverse),document.addEventListener("mousemove",C),document.addEventListener("mouseup",x),document.addEventListener("touchmove",C),document.addEventListener("touchend",x)}),me(()=>{a.off("channel_change",B),a.off("values",N),a.off("all_values",z),a.off("input_to_ui",X),a.off("blackout",Y),document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",x),document.removeEventListener("touchmove",C),document.removeEventListener("touchend",x)});function P(){r.value=a.getUniverseValues(s.currentUniverse)}async function j(e){s.currentUniverse=e,a.requestValues(e),P(),I.value=new Array(512).fill(0),await s.loadChannelLabels(e)}function H(e){j(e),g.value=!1}function B(e){if(e.universe_id===s.currentUniverse){r.value[e.channel-1]=e.value;const t=e.channel;e.source==="group"?(h.value[t]&&clearTimeout(h.value[t]),h.value[t]=setTimeout(()=>{delete h.value[t]},500)):e.source&&(e.source.startsWith("user_")||e.source==="local")&&(u.value[t]&&clearTimeout(u.value[t]),u.value[t]=setTimeout(()=>{delete u.value[t]},500))}}function N(e){if(e.universe_id===s.currentUniverse){const t=r.value;r.value=[...e.values];for(let n=0;n<e.values.length;n++)if(e.values[n]!==t[n]){const l=n+1;u.value[l]&&clearTimeout(u.value[l]),u.value[l]=setTimeout(()=>{delete u.value[l]},500)}}}function z(e){e[s.currentUniverse]&&(r.value=[...e[s.currentUniverse]])}function X(e){if(e.universe_id===s.currentUniverse){const t=e.values,n=[];for(let l=0;l<t.length;l++)t[l]!==R.value[l]&&(n.push(l+1),r.value[l]=t[l]);if(n.length>0){if(A||(a.setActiveScene(null),A=setTimeout(()=>{A=null},100)),y){clearTimeout(y);for(const l of k)delete b.value[l]}for(const l of n)b.value[l]=!0;k=n,y=setTimeout(()=>{for(const l of k)delete b.value[l];y=null,k=[]},500)}R.value=[...t],I.value=[...t]}}function K(e){return!!b.value[e]}function Q(e){return!!u.value[e]}function ee(e){return!!h.value[e]}function Y(e){for(const t of V.value)u.value[t]&&clearTimeout(u.value[t]),u.value[t]=setTimeout(()=>{delete u.value[t]},500)}function $(e,t){t=Math.max(0,Math.min(255,t));const n=r.value[e-1];t!==n&&(r.value[e-1]=t,M.value[e]=t,S&&clearTimeout(S),S=setTimeout(()=>{const l={...M.value};M.value={},Object.keys(l).length>0&&s.setChannels(l)},30),s.sceneRecallInProgress||a.setActiveScene(null))}function te(e){const t=r.value[e-1];$(e,Math.min(255,t+5))}function ne(e){const t=r.value[e-1];$(e,Math.max(0,t-5))}function D(e){const t={};let n=!1;for(const l of V.value)r.value[l-1]!==e&&(n=!0),t[l]=e,r.value[l-1]=e;n&&(s.setChannels(t),s.sceneRecallInProgress||a.setActiveScene(null))}function q(e,t){e.preventDefault(),_.value={channel:t,element:e.target.closest(".fader-track")},C(e)}function C(e){if(!_.value)return;e.preventDefault();const{channel:t,element:n}=_.value,l=n.getBoundingClientRect(),re=e.touches?e.touches[0].clientY:e.clientY,ue=l.bottom-re,ie=l.height,ce=Math.round(Math.max(0,Math.min(255,ue/ie*255)));$(t,ce)}function x(){_.value=null}function J(e){return s.getChannelLabel(s.currentUniverse,e)}function se(e){return s.getChannelColor(s.currentUniverse,e)||"var(--accent)"}function O(e){return s.getChannelGroupColor(s.currentUniverse,e)}function le(e){const t=s.getChannelGroupColor(s.currentUniverse,e),n=s.getChannelGroupColor(s.currentUniverse,e-1);return t&&n&&t===n}function oe(e){const t=s.getChannelGroupColor(s.currentUniverse,e),n=s.getChannelGroupColor(s.currentUniverse,e+1);return t&&n&&t===n}function ae(e){const t=s.getChannelColor(s.currentUniverse,e);return t?{boxShadow:`inset 0 0 0 2px ${t}`}:{}}function W(e){return s.getChannelFaderName(s.currentUniverse,e)||""}return(e,t)=>(v(),c("div",null,[o("div",_e,[o("div",be,[t[8]||(t[8]=o("h2",{class:"card-title"},"Fader Control",-1)),o("div",ye,[o("button",{class:"btn btn-small btn-secondary",onClick:t[0]||(t[0]=n=>g.value=!0)},"Jump"),o("div",ke,[he(o("input",{type:"number",class:"form-input","onUpdate:modelValue":t[1]||(t[1]=n=>d.value=n),min:"1",max:"512",style:{width:"60px"}},null,512),[[ge,d.value,void 0,{number:!0}]]),t[7]||(t[7]=o("span",{style:{"font-size":"12px",color:"var(--text-secondary)"}},"per page",-1))])])]),o("div",xe,[(v(!0),c(U,null,w(T(s).universes,n=>(v(),c("button",{key:n.id,class:f(["universe-tab",{active:T(s).currentUniverse===n.id}]),onClick:l=>j(n.id)},p(n.label),11,Ue))),128))])]),g.value?(v(),c("div",{key:0,class:"modal-overlay",onClick:t[3]||(t[3]=Ce(n=>g.value=!1,["self"]))},[o("div",we,[o("div",Te,[t[9]||(t[9]=o("h4",null,"Select Universe",-1)),o("button",{class:"modal-close",onClick:t[2]||(t[2]=n=>g.value=!1)},"×")]),o("div",Ae,[(v(!0),c(U,null,w(T(s).universes,n=>(v(),c("button",{key:n.id,class:f(["jump-popup-item",{selected:T(s).currentUniverse===n.id}]),onClick:l=>H(n.id)},p(n.label),11,Me))),128))])])])):Z("",!0),o("div",Se,[o("div",Ve,[t[10]||(t[10]=o("span",{style:{color:"var(--text-secondary)"}},"Channels:",-1)),(v(!0),c(U,null,w(F.value,n=>(v(),c("button",{key:n.start,class:f(["btn btn-small",m.value.start===n.start?"btn-primary":"btn-secondary"]),onClick:l=>m.value=n},p(n.start)+"-"+p(n.end),11,Le))),128))])]),o("div",$e,[o("div",De,[(v(!0),c(U,null,w(V.value,n=>(v(),c("div",{key:n,class:"fader-container"},[o("div",Ee,[o("span",{class:f(["indicator indicator-remote",{active:K(n)}]),title:"External DMX input"},null,2),o("span",{class:f(["indicator indicator-local",{active:Q(n)}]),title:"DMXX control"},null,2),o("span",{class:f(["indicator indicator-group",{active:ee(n)}]),title:"Group/Master control"},null,2)]),o("span",{class:"fader-label",title:J(n)},p(n),9,Ge),o("span",{class:f(["fader-name",{"fader-name-placeholder":!W(n)}]),title:J(n)},p(W(n)||"—"),11,Ie),o("button",{class:"fader-btn",onClick:l=>te(n)},"+",8,Re),o("div",{class:"fader-track",style:G(ae(n)),onMousedown:l=>q(l,n),onTouchstart:l=>q(l,n)},[o("div",{class:"fader-fill",style:G({height:L.value[n-1]/255*100+"%",background:se(n)})},null,4)],44,Fe),o("button",{class:"fader-btn",onClick:l=>ne(n)},"-",8,Pe),o("span",je,[o("span",Be,p(Math.round(L.value[n-1]/255*100))+"%",1),o("span",Ne,p(L.value[n-1]),1)]),O(n)?(v(),c("div",{key:0,class:f(["fader-group-stripe",{"connects-left":le(n),"connects-right":oe(n)}]),style:G({backgroundColor:O(n)})},null,6)):Z("",!0)]))),128))])]),o("div",ze,[o("div",Xe,[o("button",{class:"btn btn-secondary",onClick:t[4]||(t[4]=n=>D(255))},"All Full"),o("button",{class:"btn btn-secondary",onClick:t[5]||(t[5]=n=>D(0))},"All Zero"),o("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=n=>D(128))},"All 50%")])])]))}},Oe=ve(Ye,[["__scopeId","data-v-826afef3"]]);export{Oe as default};
