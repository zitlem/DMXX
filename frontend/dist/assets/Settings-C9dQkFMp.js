import{_ as te,u as se,y as ae,r as v,h as le,o as oe,c as n,b as e,d as b,F as _,l as w,m as d,n as ne,p as U,t as u,e as g,s as re,v as k,q as R,D as V,f as r}from"./index-BCRoANWK.js";const ie={class:"settings-container"},de={class:"card",style:{"margin-bottom":"16px"}},ue={class:"form-group"},ce={class:"theme-presets"},pe=["onClick"],me={class:"theme-preview"},ve={class:"form-group"},be={class:"color-grid"},fe={class:"color-label"},ge={class:"color-input-wrapper"},ye=["value","onInput"],he=["value","onChange"],_e={key:0,class:"warning-banner"},we={style:{"margin-top":"16px",display:"flex",gap:"8px"}},ke={class:"card",style:{"margin-bottom":"16px"}},Ce={class:"form-group"},xe={class:"form-group"},Pe={class:"form-group"},Se={class:"form-group"},Te={key:0,class:"card",style:{"margin-bottom":"16px"}},De={class:"data-table"},Fe={class:"auth-badges"},Ae={key:0,class:"auth-badge"},Be={key:1,class:"auth-badge ip-badge"},Ie={class:"page-badges"},$e=["onClick"],Ue=["onClick","disabled"],Ne={key:0},Ee={class:"card",style:{"margin-bottom":"16px"}},Re={class:"card-header"},Ve={class:"data-table"},Oe=["onClick"],ze=["onClick"],He={key:0},Le={key:1,class:"modal-overlay"},je={class:"modal"},Me={class:"modal-header"},Ge={class:"form-group"},Je={class:"modal-footer"},We={key:2,class:"modal-overlay"},qe={class:"modal"},Xe={class:"modal-header"},Ye={style:{color:"var(--text-secondary)"}},Ze={class:"modal-footer"},Ke={key:3,class:"modal-overlay"},Qe={class:"modal"},et={class:"modal-header"},tt={class:"modal-footer"},st={key:4,class:"modal-overlay"},at={class:"modal"},lt={class:"modal-header"},ot={class:"modal-title"},nt={class:"form-group"},rt={class:"form-group"},it=["placeholder"],dt={class:"form-group"},ut=["onUpdate:modelValue"],ct=["onClick"],pt={class:"form-group"},mt={class:"page-checkboxes"},vt=["value"],bt={class:"form-group"},ft={class:"page-checkbox-label"},gt={key:0,class:"alert alert-error"},yt={class:"modal-footer"},ht=["disabled"],_t={__name:"Settings",setup(wt){const P=se(),c=ae(),O={bgPrimary:{label:"Background Primary"},bgSecondary:{label:"Background Secondary"},bgTertiary:{label:"Background Tertiary"},textPrimary:{label:"Text Primary"},textSecondary:{label:"Text Secondary"},accent:{label:"Accent"},accentHover:{label:"Accent Hover"},success:{label:"Success"},warning:{label:"Warning"},error:{label:"Error"},border:{label:"Border"},faderBg:{label:"Fader Background"},faderFill:{label:"Fader Fill"},indicatorRemote:{label:"Remote Indicator"},indicatorLocal:{label:"Local Indicator"},indicatorGroup:{label:"Group Indicator"}},f=v({default_transition_type:"instant",default_transition_duration:0,dmx_refresh_rate:40,websocket_update_rate:30}),A=v([]),x=v(!1),S=v(""),y=v(null),C=v(null),B=v([]),T=v(!1),i=v(null),l=v({name:"",password:"",ip_addresses:[],allowed_pages:[],is_admin:!1}),p=v(""),z=[{id:"faders",name:"Faders"},{id:"scenes",name:"Scenes"},{id:"fixtures",name:"Fixtures"},{id:"patch",name:"Patch"},{id:"io",name:"I/O"},{id:"groups",name:"Groups"},{id:"settings",name:"Settings"}],H={faders:"Faders",scenes:"Scenes",fixtures:"Fixtures",patch:"Patch",io:"I/O",groups:"Groups",settings:"Settings"},L=le(()=>{if(!l.value.name||l.value.allowed_pages.length===0)return!1;const a=l.value.password||i.value&&i.value.has_password,t=l.value.ip_addresses.filter(s=>s.trim()).length>0;return!(!i.value&&!a&&!t)});oe(async()=>{await N(),await I(),await F()});async function m(a,t={}){return t.headers={...t.headers,...P.getAuthHeaders()},fetch(a,t)}async function N(){try{const t=await(await m("/api/settings")).json();f.value=t.settings}catch(a){console.error("Failed to load settings:",a)}}async function D(a){try{await m("/api/settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:a,value:String(f.value[a])})})}catch(t){console.error("Failed to save setting:",t)}}async function I(){try{const t=await(await m("/api/backup/list")).json();A.value=t.backups}catch(a){console.error("Failed to load backups:",a)}}async function j(){try{await m("/api/backup/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment:S.value})}),await I(),x.value=!1,S.value=""}catch(a){console.error("Failed to create backup:",a)}}function M(a){y.value=a}async function G(){try{await m(`/api/backup/restore/${y.value.id}`,{method:"POST"}),alert("Backup restored. Please restart the application.")}catch(a){console.error("Failed to restore backup:",a)}y.value=null}function J(a){C.value=a}async function W(){try{await m(`/api/backup/${C.value.id}`,{method:"DELETE"}),await I()}catch(a){console.error("Failed to delete backup:",a)}C.value=null}async function q(){if(confirm(`WARNING: This will delete ALL data including universes, fixtures, scenes, patches, profiles, and API tokens. Only backups will be preserved.

Are you sure you want to reset everything?`))try{await m("/api/settings/reset",{method:"POST"}),await N(),await F()}catch(a){console.error("Failed to reset settings:",a)}}function E(a){return new Date(a).toLocaleString()}async function F(){if(P.isAdmin)try{const a=await m("/api/auth/profiles");a.ok&&(B.value=await a.json())}catch(a){console.error("Failed to load profiles:",a)}}function X(){i.value=null,l.value={name:"",password:"",ip_addresses:[],allowed_pages:[],is_admin:!1},p.value="",T.value=!0}function Y(a){i.value=a,l.value={name:a.name,password:"",ip_addresses:a.ip_addresses?[...a.ip_addresses]:[],allowed_pages:[...a.allowed_pages],is_admin:a.is_admin},p.value="",T.value=!0}function Z(){l.value.ip_addresses.push("")}function K(a){l.value.ip_addresses.splice(a,1)}async function Q(){if(p.value="",!l.value.name.trim()){p.value="Profile name is required";return}if(l.value.allowed_pages.length===0){p.value="Select at least one page";return}const a=l.value.ip_addresses.filter(t=>t.trim());if(l.value.password||i.value&&i.value.has_password,!i.value&&!l.value.password&&a.length===0){p.value="Profile must have either a password or IP addresses";return}try{const t={name:l.value.name.trim(),allowed_pages:l.value.allowed_pages,is_admin:l.value.is_admin};l.value.password&&(t.password=l.value.password),t.ip_addresses=a.length>0?a:null;let s;if(i.value?s=await m(`/api/auth/profiles/${i.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}):s=await m("/api/auth/profiles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),s.ok)await F(),$();else{const o=await s.json();p.value=o.detail||"Failed to save profile"}}catch(t){console.error("Failed to save profile:",t),p.value="Failed to save profile"}}function $(){T.value=!1,i.value=null,l.value={name:"",password:"",ip_addresses:[],allowed_pages:[],is_admin:!1},p.value=""}async function ee(a){if(confirm(`Are you sure you want to delete the "${a.name}" profile?`))try{const t=await m(`/api/auth/profiles/${a.id}`,{method:"DELETE"});if(t.ok)await F();else{const s=await t.json();alert(s.detail||"Failed to delete profile")}}catch(t){console.error("Failed to delete profile:",t),alert("Failed to delete profile")}}return(a,t)=>(r(),n("div",ie,[t[55]||(t[55]=e("h2",{class:"card-title",style:{"margin-bottom":"16px"}},"Settings",-1)),e("div",de,[t[25]||(t[25]=e("div",{class:"card-header"},[e("h3",{class:"card-title"},"Theme")],-1)),e("div",ue,[t[22]||(t[22]=e("label",{class:"form-label"},"Preset Theme",-1)),e("div",ce,[(r(!0),n(_,null,w(d(c).presets,(s,o)=>(r(),n("button",{key:o,class:ne(["theme-preset-btn",{active:d(c).themeData.presetName===o}]),onClick:h=>d(c).setPreset(o)},[e("div",me,[e("div",{class:"preview-swatch",style:U({background:s.bgPrimary})},null,4),e("div",{class:"preview-swatch",style:U({background:s.accent})},null,4),e("div",{class:"preview-swatch",style:U({background:s.textPrimary})},null,4)]),e("span",null,u(o.charAt(0).toUpperCase()+o.slice(1)),1)],10,pe))),128))])]),e("div",ve,[t[23]||(t[23]=e("label",{class:"form-label"},"Custom Colors",-1)),t[24]||(t[24]=e("p",{style:{"font-size":"12px",color:"var(--text-secondary)","margin-bottom":"12px"}}," Customize individual colors. Changes are applied immediately. ",-1)),e("div",be,[(r(),n(_,null,w(O,(s,o)=>e("div",{class:"color-picker-group",key:o},[e("label",fe,u(s.label),1),e("div",ge,[e("input",{type:"color",value:d(c).themeData.colors[o],onInput:h=>d(c).setCustomColor(o,h.target.value)},null,40,ye),e("input",{type:"text",class:"form-input color-hex",value:d(c).themeData.colors[o],onChange:h=>d(c).setCustomColor(o,h.target.value)},null,40,he)])])),64))]),d(c).hasUnsavedChanges?(r(),n("div",_e,' You have unsaved theme changes. Click "Save Custom Theme" to apply to all clients. ')):b("",!0),e("div",we,[e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...s)=>d(c).saveCustomTheme&&d(c).saveCustomTheme(...s))}," Save Custom Theme "),e("button",{class:"btn btn-secondary",onClick:t[1]||(t[1]=(...s)=>d(c).resetToDefault&&d(c).resetToDefault(...s))}," Reset to Default ")])])]),e("div",ke,[t[33]||(t[33]=e("div",{class:"card-header"},[e("h3",{class:"card-title"},"General")],-1)),e("div",Ce,[t[27]||(t[27]=e("label",{class:"form-label"},"Default Transition Type",-1)),g(e("select",{class:"form-select","onUpdate:modelValue":t[2]||(t[2]=s=>f.value.default_transition_type=s),onChange:t[3]||(t[3]=s=>D("default_transition_type"))},[...t[26]||(t[26]=[e("option",{value:"instant"},"Instant",-1),e("option",{value:"fade"},"Fade",-1),e("option",{value:"crossfade"},"Crossfade",-1)])],544),[[re,f.value.default_transition_type]])]),e("div",xe,[t[28]||(t[28]=e("label",{class:"form-label"},"Default Transition Duration (ms)",-1)),g(e("input",{type:"number",class:"form-input","onUpdate:modelValue":t[4]||(t[4]=s=>f.value.default_transition_duration=s),onChange:t[5]||(t[5]=s=>D("default_transition_duration")),min:"0",step:"100"},null,544),[[k,f.value.default_transition_duration,void 0,{number:!0}]])]),e("div",Pe,[t[29]||(t[29]=e("label",{class:"form-label"},"DMX Refresh Rate (Hz)",-1)),g(e("input",{type:"number",class:"form-input","onUpdate:modelValue":t[6]||(t[6]=s=>f.value.dmx_refresh_rate=s),onChange:t[7]||(t[7]=s=>D("dmx_refresh_rate")),min:"1",max:"44",step:"1"},null,544),[[k,f.value.dmx_refresh_rate,void 0,{number:!0}]]),t[30]||(t[30]=e("p",{style:{"font-size":"12px",color:"var(--text-secondary)","margin-top":"4px"}}," How often DMX data is sent to outputs (1-44 Hz). Higher = smoother fades but more CPU. ",-1))]),e("div",Se,[t[31]||(t[31]=e("label",{class:"form-label"},"WebSocket Update Rate (Hz)",-1)),g(e("input",{type:"number",class:"form-input","onUpdate:modelValue":t[8]||(t[8]=s=>f.value.websocket_update_rate=s),onChange:t[9]||(t[9]=s=>D("websocket_update_rate")),min:"1",max:"60",step:"1"},null,544),[[k,f.value.websocket_update_rate,void 0,{number:!0}]]),t[32]||(t[32]=e("p",{style:{"font-size":"12px",color:"var(--text-secondary)","margin-top":"4px"}}," How often UI updates are sent to connected clients (1-60 Hz). ",-1))])]),d(P).isAdmin?(r(),n("div",Te,[e("div",{class:"card-header"},[t[34]||(t[34]=e("h3",{class:"card-title"},"Access Profiles",-1)),e("button",{class:"btn btn-primary",onClick:X},"Create Profile")]),t[37]||(t[37]=e("p",{style:{"font-size":"12px",color:"var(--text-secondary)","margin-bottom":"12px"}}," Different passwords grant access to different profiles. Each profile can access only specific pages. ",-1)),e("table",De,[t[36]||(t[36]=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Auth"),e("th",null,"Allowed Pages"),e("th",null,"Admin"),e("th",null,"Actions")])],-1)),e("tbody",null,[(r(!0),n(_,null,w(B.value,s=>(r(),n("tr",{key:s.id},[e("td",null,u(s.name),1),e("td",null,[e("span",Fe,[s.has_password?(r(),n("span",Ae,"Password")):b("",!0),s.ip_addresses&&s.ip_addresses.length?(r(),n("span",Be,u(s.ip_addresses.length)+" IP"+u(s.ip_addresses.length>1?"s":""),1)):b("",!0)])]),e("td",null,[e("span",Ie,[(r(!0),n(_,null,w(s.allowed_pages,o=>(r(),n("span",{key:o,class:"page-badge"},u(H[o]||o),1))),128))])]),e("td",null,u(s.is_admin?"Yes":"No"),1),e("td",null,[e("button",{class:"btn btn-small btn-secondary",onClick:o=>Y(s)},"Edit",8,$e),e("button",{class:"btn btn-small btn-danger",onClick:o=>ee(s),disabled:s.name===d(P).profileName},"Delete",8,Ue)])]))),128)),B.value.length===0?(r(),n("tr",Ne,[...t[35]||(t[35]=[e("td",{colspan:"5",style:{"text-align":"center",color:"var(--text-secondary)"}}," No profiles yet ",-1)])])):b("",!0)])])])):b("",!0),e("div",Ee,[e("div",Re,[t[38]||(t[38]=e("h3",{class:"card-title"},"Backup & Restore",-1)),e("button",{class:"btn btn-primary",onClick:t[10]||(t[10]=s=>x.value=!0)},"Create Backup")]),e("table",Ve,[t[40]||(t[40]=e("thead",null,[e("tr",null,[e("th",null,"Date"),e("th",null,"Comment"),e("th",null,"Actions")])],-1)),e("tbody",null,[(r(!0),n(_,null,w(A.value,s=>(r(),n("tr",{key:s.id},[e("td",null,u(E(s.timestamp)),1),e("td",null,u(s.comment||"-"),1),e("td",null,[e("button",{class:"btn btn-small btn-secondary",onClick:o=>M(s)},"Restore",8,Oe),e("button",{class:"btn btn-small btn-danger",onClick:o=>J(s)},"Delete",8,ze)])]))),128)),A.value.length===0?(r(),n("tr",He,[...t[39]||(t[39]=[e("td",{colspan:"3",style:{"text-align":"center",color:"var(--text-secondary)"}}," No backups yet ",-1)])])):b("",!0)])])]),e("div",{class:"card",style:{"border-color":"var(--error)"}},[t[41]||(t[41]=e("div",{class:"card-header"},[e("h3",{class:"card-title",style:{color:"var(--error)"}},"Danger Zone")],-1)),e("button",{class:"btn btn-danger",onClick:q},"Reset Everything")]),x.value?(r(),n("div",Le,[e("div",je,[e("div",Me,[t[42]||(t[42]=e("h3",{class:"modal-title"},"Create Backup",-1)),e("button",{class:"modal-close",onClick:t[11]||(t[11]=s=>x.value=!1)},"×")]),e("div",Ge,[t[43]||(t[43]=e("label",{class:"form-label"},"Comment (optional)",-1)),g(e("input",{type:"text",class:"form-input","onUpdate:modelValue":t[12]||(t[12]=s=>S.value=s),placeholder:"e.g., Before show update"},null,512),[[k,S.value]])]),e("div",Je,[e("button",{class:"btn btn-secondary",onClick:t[13]||(t[13]=s=>x.value=!1)},"Cancel"),e("button",{class:"btn btn-primary",onClick:j},"Create")])])])):b("",!0),y.value?(r(),n("div",We,[e("div",qe,[e("div",Xe,[t[44]||(t[44]=e("h3",{class:"modal-title"},"Restore Backup",-1)),e("button",{class:"modal-close",onClick:t[14]||(t[14]=s=>y.value=null)},"×")]),t[45]||(t[45]=e("p",null,"Are you sure you want to restore from this backup?",-1)),e("p",Ye,u(E(y.value.timestamp)),1),t[46]||(t[46]=e("p",{style:{color:"var(--warning)","margin-top":"8px"}},"This will overwrite current data. The application will need to restart.",-1)),e("div",Ze,[e("button",{class:"btn btn-secondary",onClick:t[15]||(t[15]=s=>y.value=null)},"Cancel"),e("button",{class:"btn btn-danger",onClick:G},"Restore")])])])):b("",!0),C.value?(r(),n("div",Ke,[e("div",Qe,[e("div",et,[t[47]||(t[47]=e("h3",{class:"modal-title"},"Delete Backup",-1)),e("button",{class:"modal-close",onClick:t[16]||(t[16]=s=>C.value=null)},"×")]),t[48]||(t[48]=e("p",null,"Are you sure you want to delete this backup?",-1)),e("div",tt,[e("button",{class:"btn btn-secondary",onClick:t[17]||(t[17]=s=>C.value=null)},"Cancel"),e("button",{class:"btn btn-danger",onClick:W},"Delete")])])])):b("",!0),T.value?(r(),n("div",st,[e("div",at,[e("div",lt,[e("h3",ot,u(i.value?"Edit Profile":"Create Profile"),1),e("button",{class:"modal-close",onClick:$},"×")]),e("div",nt,[t[49]||(t[49]=e("label",{class:"form-label"},"Profile Name",-1)),g(e("input",{type:"text",class:"form-input","onUpdate:modelValue":t[18]||(t[18]=s=>l.value.name=s),placeholder:"e.g., Operator"},null,512),[[k,l.value.name]])]),e("div",rt,[t[50]||(t[50]=e("label",{class:"form-label"},"Password (optional if using IP)",-1)),g(e("input",{type:"password",class:"form-input","onUpdate:modelValue":t[19]||(t[19]=s=>l.value.password=s),placeholder:i.value?"Leave blank to keep current":"Enter password"},null,8,it),[[k,l.value.password]])]),e("div",dt,[t[51]||(t[51]=e("label",{class:"form-label"},"IP Addresses (optional if using password)",-1)),t[52]||(t[52]=e("p",{style:{"font-size":"12px",color:"var(--text-secondary)","margin-bottom":"8px"}}," Users from these IPs will automatically use this profile. Use * for wildcards (e.g., 192.168.1.*). Exact IPs are matched before wildcards, so you can use 10.1.10.* for users and 10.1.10.102 for admin. ",-1)),(r(!0),n(_,null,w(l.value.ip_addresses,(s,o)=>(r(),n("div",{key:o,class:"ip-row"},[g(e("input",{type:"text",class:"form-input","onUpdate:modelValue":h=>l.value.ip_addresses[o]=h,placeholder:"e.g., 192.168.1.100"},null,8,ut),[[k,l.value.ip_addresses[o]]]),e("button",{class:"btn btn-small btn-danger",onClick:h=>K(o)},"Remove",8,ct)]))),128)),e("button",{class:"btn btn-small btn-secondary",onClick:Z,style:{"margin-top":"8px"}},"Add IP")]),e("div",pt,[t[53]||(t[53]=e("label",{class:"form-label"},"Allowed Pages",-1)),e("div",mt,[(r(),n(_,null,w(z,s=>e("label",{key:s.id,class:"page-checkbox-label"},[g(e("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":t[20]||(t[20]=o=>l.value.allowed_pages=o)},null,8,vt),[[V,l.value.allowed_pages]]),R(" "+u(s.name),1)])),64))])]),e("div",bt,[e("label",ft,[g(e("input",{type:"checkbox","onUpdate:modelValue":t[21]||(t[21]=s=>l.value.is_admin=s)},null,512),[[V,l.value.is_admin]]),t[54]||(t[54]=R(" Admin (can manage profiles and access all settings) ",-1))])]),p.value?(r(),n("div",gt,u(p.value),1)):b("",!0),e("div",yt,[e("button",{class:"btn btn-secondary",onClick:$},"Cancel"),e("button",{class:"btn btn-primary",onClick:Q,disabled:!L.value},u(i.value?"Update":"Create"),9,ht)])])])):b("",!0)]))}},Ct=te(_t,[["__scopeId","data-v-29c761b8"]]);export{Ct as default};
