import{_ as B,g as G,u as H,r as v,h as J,o as z,c as s,b as e,d as y,F,l as w,t as r,m as D,q as c,e as b,v as _,s as R,x as S,f as i}from"./index-BCRoANWK.js";const q={class:"card-header",style:{"margin-bottom":"16px"}},W={style:{display:"flex",gap:"8px"}},X={class:"card"},K={class:"data-table"},Q={class:"action-buttons"},Y=["onClick"],Z=["onClick"],ee=["onClick"],te=["onClick"],ae={key:0},ne={key:0,class:"modal-overlay"},oe={class:"modal"},le={class:"modal-header"},se={class:"modal-title"},re={style:{"margin-bottom":"12px"}},ie={style:{"margin-bottom":"16px"}},de={class:"data-table"},ue={key:1,class:"modal-overlay"},ce={class:"modal",style:{"max-width":"700px"}},me={class:"modal-header"},pe={class:"modal-title"},ve={class:"form-group"},fe={class:"form-group"},ye={style:{"margin-bottom":"16px"}},be=["onUpdate:modelValue","onInput"],he=["onUpdate:modelValue"],xe=["onUpdate:modelValue"],ge=["onUpdate:modelValue"],_e=["onClick"],Ce={class:"modal-footer"},ke=["disabled"],Fe={key:2,class:"modal-overlay"},we={class:"modal"},Ne={class:"modal-header"},De={class:"form-group"},Se={key:0,class:"alert alert-error"},$e={class:"modal-footer"},Ve={key:3,class:"modal-overlay"},Oe={class:"modal"},Ue={class:"modal-header"},Le={class:"modal-footer"},Ie={__name:"FixtureLibrary",setup(Me){const f=G(),C=H(),h=v(!1),x=v(!1),m=v(null),p=v(null),g=v(""),u=v(null),$={red:"#ff0000",green:"#00ff00",blue:"#0000ff",white:"#ffffff",amber:"#ffbf00",cyan:"#00ffff",magenta:"#ff00ff",yellow:"#ffff00",uv:"#8b00ff",ultraviolet:"#8b00ff",warm:"#ffd700",cool:"#87ceeb",orange:"#ff8000",pink:"#ff69b4",lime:"#32cd32"},N=()=>({name:"",manufacturer:"",channels:[{name:"Dimmer",type:"intensity",color:"#888888",faderName:""}]}),o=v(N()),V=J(()=>o.value.name&&o.value.channels.length>0);z(async()=>{await f.loadFixtures()});function O(){o.value.channels.push({name:"",type:"intensity",color:"#888888",faderName:""})}function U(n){o.value.channels.splice(n,1)}function L(n){const t=n.name.toLowerCase();for(const[a,l]of Object.entries($))if(t.includes(a)){n.color=l;return}}function I(n){u.value=n.id;const t=n.channels||[];o.value={name:n.name,manufacturer:n.manufacturer||"",channels:t.map(a=>({name:a.name||"",type:a.type||"intensity",color:a.color||"#888888",faderName:a.faderName||""}))},o.value.channels.length===0&&(o.value.channels=[{name:"Dimmer",type:"intensity",color:"#888888",faderName:""}]),h.value=!0}function k(){h.value=!1,u.value=null,o.value=N()}async function M(){try{const n=u.value?"PUT":"POST",t=u.value?`/api/fixtures/${u.value}`:"/api/fixtures";(await fetch(t,{method:n,headers:{"Content-Type":"application/json",...C.getAuthHeaders()},body:JSON.stringify({name:o.value.name,manufacturer:o.value.manufacturer,definition_json:{channels:o.value.channels}})})).ok&&(await f.loadFixtures(),k())}catch(n){console.error("Failed to save fixture:",n)}}async function T(n){const t=n.target.files[0];if(t){g.value="";try{const a=new FormData;a.append("file",t);const l=await fetch("/api/fixtures/import/ofl",{method:"POST",headers:C.getAuthHeaders(),body:a});if(l.ok)await f.loadFixtures(),x.value=!1;else{const d=await l.json();g.value=d.detail||"Import failed"}}catch{g.value="Failed to import file"}}}function E(n){m.value=n}function j(n){p.value=n}async function A(){try{const n=await fetch(`/api/fixtures/${p.value.id}`,{method:"DELETE",headers:C.getAuthHeaders()});if(n.ok)await f.loadFixtures();else{const t=await n.json();alert(t.detail||"Delete failed")}}catch(n){console.error("Failed to delete fixture:",n)}p.value=null}function P(n){u.value=null;const t=n.channels||[];o.value={name:`${n.name} (Copy)`,manufacturer:n.manufacturer||"",channels:t.map(a=>({name:a.name||"",type:a.type||"intensity",color:a.color||"#888888",faderName:a.faderName||""}))},o.value.channels.length===0&&(o.value.channels=[{name:"Dimmer",type:"intensity",color:"#888888",faderName:""}]),h.value=!0}return(n,t)=>(i(),s("div",null,[e("div",q,[t[9]||(t[9]=e("h2",{class:"card-title"},"Fixture Library",-1)),e("div",W,[e("button",{class:"btn btn-secondary",onClick:t[0]||(t[0]=a=>x.value=!0)},"Import OFL"),e("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=a=>h.value=!0)},"+ Create Fixture")])]),e("div",X,[e("table",K,[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,[e("span",{class:"hide-mobile"},"Manufacturer"),e("span",{class:"show-mobile"},"Manuf")]),e("th",null,"Channels"),e("th",null,"Actions")])],-1)),e("tbody",null,[(i(!0),s(F,null,w(D(f).fixtures,a=>(i(),s("tr",{key:a.id},[e("td",null,r(a.name),1),e("td",null,r(a.manufacturer||"-"),1),e("td",null,r(a.channel_count),1),e("td",Q,[e("button",{class:"btn btn-small btn-secondary",onClick:l=>E(a)},"View",8,Y),e("button",{class:"btn btn-small btn-secondary",onClick:l=>I(a)},"Edit",8,Z),e("button",{class:"btn btn-small btn-secondary",onClick:l=>P(a)},"Duplicate",8,ee),e("button",{class:"btn btn-small btn-danger",onClick:l=>j(a)},"Delete",8,te)])]))),128)),D(f).fixtures.length===0?(i(),s("tr",ae,[...t[10]||(t[10]=[e("td",{colspan:"4",style:{"text-align":"center",color:"var(--text-secondary)"}}," No fixtures in library. Create a fixture or import from Open Fixture Library. ",-1)])])):y("",!0)])])]),m.value?(i(),s("div",ne,[e("div",oe,[e("div",le,[e("h3",se,r(m.value.name),1),e("button",{class:"modal-close",onClick:t[2]||(t[2]=a=>m.value=null)},"×")]),e("div",re,[t[12]||(t[12]=e("span",{style:{color:"var(--text-secondary)"}},"Manufacturer:",-1)),c(" "+r(m.value.manufacturer||"Unknown"),1)]),e("div",ie,[t[13]||(t[13]=e("span",{style:{color:"var(--text-secondary)"}},"Channels:",-1)),c(" "+r(m.value.channel_count),1)]),e("table",de,[t[14]||(t[14]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Name"),e("th",null,"Type")])],-1)),e("tbody",null,[(i(!0),s(F,null,w(m.value.channels,(a,l)=>(i(),s("tr",{key:l},[e("td",null,r(l+1),1),e("td",null,r(a.name),1),e("td",null,r(a.type),1)]))),128))])])])])):y("",!0),h.value?(i(),s("div",ue,[e("div",ce,[e("div",me,[e("h3",pe,r(u.value?"Edit Fixture":"Create Fixture"),1),e("button",{class:"modal-close",onClick:k},"×")]),e("div",ve,[t[15]||(t[15]=e("label",{class:"form-label"},"Fixture Name",-1)),b(e("input",{type:"text",class:"form-input","onUpdate:modelValue":t[3]||(t[3]=a=>o.value.name=a),placeholder:"e.g., My Par Can"},null,512),[[_,o.value.name]])]),e("div",fe,[t[16]||(t[16]=e("label",{class:"form-label"},"Manufacturer",-1)),b(e("input",{type:"text",class:"form-input","onUpdate:modelValue":t[4]||(t[4]=a=>o.value.manufacturer=a),placeholder:"e.g., Generic"},null,512),[[_,o.value.manufacturer]])]),e("div",ye,[e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"8px"}},[t[17]||(t[17]=e("label",{class:"form-label",style:{margin:"0"}},"Channels",-1)),e("button",{class:"btn btn-small btn-secondary",onClick:O},"+ Add Channel")]),t[19]||(t[19]=e("div",{style:{"font-size":"11px",color:"var(--text-secondary)","margin-bottom":"12px","line-height":"1.4"}},[e("strong",null,"Intensity"),c(" = brightness/dimmer. "),e("strong",null,"Color"),c(" = RGB/RGBW mixing. "),e("strong",null,"Pan/Tilt"),c(" = moving head position. "),e("strong",null,"Gobo"),c(" = pattern wheel. "),e("strong",null,"Shutter"),c(" = strobe. "),e("strong",null,"Other"),c(" = everything else. Fader color auto-suggests from channel name. ")],-1)),(i(!0),s(F,null,w(o.value.channels,(a,l)=>(i(),s("div",{key:l,style:{display:"flex",gap:"8px","margin-bottom":"8px","align-items":"center"}},[b(e("input",{type:"text",class:"form-input","onUpdate:modelValue":d=>a.name=d,onInput:d=>L(a),placeholder:"Channel name",style:{flex:"1"}},null,40,be),[[_,a.name]]),b(e("input",{type:"text",class:"form-input","onUpdate:modelValue":d=>a.faderName=d,placeholder:"Fader",title:"Short label for fader display",style:{width:"50px"}},null,8,he),[[_,a.faderName]]),b(e("select",{class:"form-select","onUpdate:modelValue":d=>a.type=d,style:{width:"110px"}},[...t[18]||(t[18]=[S('<option value="intensity" data-v-5c84d30d>Intensity</option><option value="color" data-v-5c84d30d>Color</option><option value="pan" data-v-5c84d30d>Pan</option><option value="tilt" data-v-5c84d30d>Tilt</option><option value="gobo" data-v-5c84d30d>Gobo</option><option value="shutter" data-v-5c84d30d>Shutter</option><option value="other" data-v-5c84d30d>Other</option>',7)])],8,xe),[[R,a.type]]),b(e("input",{type:"color","onUpdate:modelValue":d=>a.color=d,title:"Fader color",style:{width:"36px",height:"28px",border:"none",cursor:"pointer",padding:"0"}},null,8,ge),[[_,a.color]]),e("button",{class:"btn btn-small btn-danger",onClick:d=>U(l)},"X",8,_e)]))),128))]),e("div",Ce,[e("button",{class:"btn btn-secondary",onClick:k},"Cancel"),e("button",{class:"btn btn-primary",onClick:M,disabled:!V.value},r(u.value?"Save":"Create"),9,ke)])])])):y("",!0),x.value?(i(),s("div",Fe,[e("div",we,[e("div",Ne,[t[20]||(t[20]=e("h3",{class:"modal-title"},"Import from Open Fixture Library",-1)),e("button",{class:"modal-close",onClick:t[5]||(t[5]=a=>x.value=!1)},"×")]),t[21]||(t[21]=S('<p style="margin-bottom:12px;color:var(--text-secondary);" data-v-5c84d30d> Upload a JSON file from the <a href="https://open-fixture-library.org/" target="_blank" style="color:var(--accent);" data-v-5c84d30d>Open Fixture Library</a></p><p style="margin-bottom:16px;font-size:12px;color:var(--text-secondary);" data-v-5c84d30d> Expected format: OFL JSON with <code style="background:var(--bg-tertiary);padding:1px 4px;border-radius:3px;" data-v-5c84d30d>name</code>, <code style="background:var(--bg-tertiary);padding:1px 4px;border-radius:3px;" data-v-5c84d30d>availableChannels</code>, and <code style="background:var(--bg-tertiary);padding:1px 4px;border-radius:3px;" data-v-5c84d30d>modes</code> fields. Download fixture files directly from OFL website. </p>',2)),e("div",De,[e("input",{type:"file",accept:".json",onChange:T,ref:"fileInput"},null,544)]),g.value?(i(),s("div",Se,r(g.value),1)):y("",!0),e("div",$e,[e("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=a=>x.value=!1)},"Cancel")])])])):y("",!0),p.value?(i(),s("div",Ve,[e("div",Oe,[e("div",Ue,[t[22]||(t[22]=e("h3",{class:"modal-title"},"Delete Fixture",-1)),e("button",{class:"modal-close",onClick:t[7]||(t[7]=a=>p.value=null)},"×")]),e("p",null,'Are you sure you want to delete "'+r(p.value.name)+'"?',1),e("div",Le,[e("button",{class:"btn btn-secondary",onClick:t[8]||(t[8]=a=>p.value=null)},"Cancel"),e("button",{class:"btn btn-danger",onClick:A},"Delete")])])])):y("",!0)]))}},Ee=B(Ie,[["__scopeId","data-v-5c84d30d"]]);export{Ee as default};
