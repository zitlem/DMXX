import{_ as be,g as me,u as ye,r,G as fe,h as he,o as ke,c as s,b as t,x as _e,d as p,F as C,l as F,t as v,m as h,e as _,v as V,s as ge,n as M,E as G,q as I,w as Ce,j as Se,I as xe,f as a}from"./index-BCRoANWK.js";const we={class:"card"},$e={class:"data-table"},Ue={class:"truncate-mobile"},Ve={class:"transition-badge"},Me={class:"action-buttons"},Te=["onClick"],Ne=["onClick"],Fe=["onClick"],Ae=["onClick"],De=["onClick"],je={key:0},Ee={key:0,class:"modal-overlay"},Je={class:"modal modal-standard"},Pe={class:"modal-header"},Be={class:"modal-title"},Re={class:"form-group"},Le={class:"form-group"},qe={key:0,class:"form-group"},ze={key:1,class:"form-group"},He={class:"universe-select-header"},Oe={class:"universe-checkboxes"},Ge=["data-universe-id"],Ie=["checked","onChange"],We={class:"checkbox-label"},Xe={key:0,class:"warning-text"},Ke={key:2,class:"form-group"},Qe={class:"modal-footer"},Ye=["disabled"],Ze={key:1,class:"modal-overlay"},et={class:"modal modal-standard"},tt={class:"modal-header"},nt={style:{color:"var(--text-secondary)"}},lt={class:"modal-footer"},st={key:2,class:"modal-overlay"},at={class:"modal modal-standard"},ot={class:"modal-header"},it={class:"form-group",style:{"margin-top":"16px"}},ut={class:"universe-select-header"},dt={class:"universe-checkboxes"},rt=["data-universe-id"],ct=["checked","onChange"],vt={class:"checkbox-label"},pt={class:"form-group"},bt={class:"radio-group"},mt={class:"radio-option"},yt={class:"radio-option"},ft={style:{color:"var(--text-secondary)","font-size":"13px","margin-top":"12px"}},ht={class:"modal-footer"},kt=["disabled"],_t={key:3,class:"modal-overlay"},gt={class:"modal modal-wide"},Ct={class:"modal-header"},St={class:"modal-title"},xt={class:"values-editor"},wt={class:"universe-tabs-row"},$t={class:"universe-tabs"},Ut=["data-universe-id","onClick"],Vt={class:"universe-tabs-actions"},Mt=["disabled"],Tt={class:"bulk-section"},Nt={class:"bulk-toggle"},Ft=["disabled"],At={class:"values-list"},Dt=["onUpdate:modelValue"],jt=["onUpdate:modelValue"],Et=["onClick"],Jt={key:0,style:{padding:"20px","text-align":"center",color:"var(--text-secondary)"}},Pt={class:"modal-footer"},Bt={class:"jump-popup"},Rt={class:"jump-popup-header"},Lt={class:"jump-popup-list"},qt=["onClick"],zt={__name:"SceneManager",setup(Ht){const b=me(),E=ye();async function W(l,e={}){return e.headers={...e.headers,...E.getAuthHeaders()},fetch(l,e)}const J=r(!1),y=r(null),x=r(null),w=r(null),$=r(null),c=r([]),{universes:d}=fe(b),S=r("add"),T=r(null),N=r(null),P=r(255),X=r(1),m=r([]),k=r([]),U=r("replace_all"),f=r(1),A=r(!1),D=r("new"),u=r({name:"",transition_type:"instant",duration:0}),K=he(()=>!(!u.value.name||!y.value&&m.value.length===0));ke(async()=>{await b.loadScenes(),await b.loadUniverses(),B()});function B(){m.value=d.value.map(l=>l.id)}function Q(l){var n;const e=[...new Set(((n=l.values)==null?void 0:n.map(o=>o.universe_id))||[])];k.value=e.length>0?e:d.value.map(o=>o.id)}function H(l,e){const n=e.indexOf(l);n===-1?e.push(l):e.splice(n,1)}function R(l){D.value=l,A.value=!0}function Y(l){if(D.value==="values")f.value=l,xe(()=>{const e=document.querySelector(`.universe-tabs button[data-universe-id="${l}"]`);e&&e.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})});else{const e=document.querySelector(`[data-universe-id="${l}"]`);e&&e.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}A.value=!1}function O(l){return c.value.filter(e=>e.universe_id===l).sort((e,n)=>e.channel-n.channel)}function L(l){const e=d.value.find(n=>n.id===l);return e?e.label:`Universe ${l}`}function Z(l){c.value.push({universe_id:l,channel:1,value:255})}function ee(l){const e=c.value.findIndex(n=>n.universe_id===l.universe_id&&n.channel===l.channel&&n.value===l.value);e!==-1&&c.value.splice(e,1)}function q(l){return c.value.filter(e=>e.universe_id===l).length}function te(l){const e=q(l);if(e===0){alert(`No values for ${L(l)}`);return}confirm(`Delete all ${e} values from ${L(l)}?`)&&(c.value=c.value.filter(n=>n.universe_id!==l))}function ne(){const l=Math.min(T.value,N.value),e=Math.max(T.value,N.value),n=f.value;if(S.value==="add"){const o=P.value??255;for(let i=l;i<=e;i++)c.value.find(g=>g.channel===i&&g.universe_id===n)||c.value.push({universe_id:n,channel:i,value:o});c.value.sort((i,g)=>i.universe_id-g.universe_id||i.channel-g.channel)}else{const o=c.value.filter(i=>i.universe_id===n&&i.channel>=l&&i.channel<=e).length;if(o===0){alert(`No channels found in range ${l}-${e} for ${L(n)}`);return}confirm(`Delete ${o} channel(s) in range ${l}-${e}?`)&&(c.value=c.value.filter(i=>i.universe_id!==n||i.channel<l||i.channel>e))}T.value=null,N.value=null}function le(l){y.value=l,u.value={name:l.name,transition_type:l.transition_type,duration:l.duration}}async function se(){d.value.length===0&&await b.loadUniverses(),B(),J.value=!0}function j(){J.value=!1,y.value=null,u.value={name:"",transition_type:"instant",duration:0},B()}async function ae(){console.log("saveScene called",{name:u.value.name,selectedUniverses:m.value,editingScene:y.value});try{if(y.value)(await fetch(`/api/scenes/update/${y.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json",...E.getAuthHeaders()},body:JSON.stringify({name:u.value.name,transition_type:u.value.transition_type,duration:u.value.transition_type==="instant"?0:u.value.duration})})).ok&&(await b.loadScenes(),j());else{const l=m.value.length===d.value.length?null:m.value;await b.createScene(u.value.name,u.value.transition_type,u.value.transition_type==="instant"?0:u.value.duration,l),j()}}catch(l){console.error("Failed to save scene:",l)}}async function oe(l){try{b.startSceneRecallGracePeriod(l.duration||0),Se.setActiveScene(l.id),await b.recallScene(l.id)}catch(e){console.error("Failed to recall scene:",e)}}function ie(l){x.value=l}async function ue(){try{await b.deleteScene(x.value.id),x.value=null}catch(l){console.error("Failed to delete scene:",l)}}function de(l){w.value=l,Q(l),U.value="replace_all"}async function re(){try{const l=k.value.length===d.value.length?null:k.value;await b.updateScene(w.value.id,l,U.value),w.value=null}catch(l){console.error("Failed to update scene values:",l)}}async function ce(l){var e,n;try{const i=await(await W(`/api/scenes/${l.id}`)).json();$.value=i,c.value=i.values?i.values.map(z=>({...z})):[],X.value=((e=d.value[0])==null?void 0:e.id)||1;const g=d.value.find(z=>c.value.some(pe=>pe.universe_id===z.id));f.value=(g==null?void 0:g.id)||((n=d.value[0])==null?void 0:n.id)||1}catch(o){console.error("Failed to load scene:",o)}}async function ve(){try{(await fetch(`/api/scenes/update/${$.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json",...E.getAuthHeaders()},body:JSON.stringify({values:c.value})})).ok&&(await b.loadScenes(),$.value=null)}catch(l){console.error("Failed to save scene values:",l)}}return(l,e)=>(a(),s("div",null,[t("div",{class:"card-header",style:{"margin-bottom":"16px"}},[e[27]||(e[27]=t("h2",{class:"card-title"},"Scene Manager",-1)),t("button",{class:"btn btn-primary",onClick:se},"+ New Scene")]),e[47]||(e[47]=_e('<div class="info-banner" data-v-abb77e0d><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-abb77e0d><circle cx="12" cy="12" r="10" data-v-abb77e0d></circle><line x1="12" y1="16" x2="12" y2="12" data-v-abb77e0d></line><line x1="12" y1="8" x2="12.01" y2="8" data-v-abb77e0d></line></svg><span data-v-abb77e0d>Channels not included in a scene will remain unchanged when recalled. To turn a light off, include the channel with value 0.</span></div>',1)),t("div",we,[t("table",$e,[e[29]||(e[29]=t("thead",null,[t("tr",null,[t("th",null,"Name"),t("th",null,"Transition"),t("th",null,"Duration"),t("th",null,"Channels"),t("th",null,"Actions")])],-1)),t("tbody",null,[(a(!0),s(C,null,F(h(b).scenes,n=>{var o;return a(),s("tr",{key:n.id},[t("td",Ue,[t("strong",null,v(n.name),1)]),t("td",null,[t("span",Ve,v(n.transition_type),1)]),t("td",null,v(n.duration>0?`${n.duration}ms`:"-"),1),t("td",null,v(((o=n.values)==null?void 0:o.length)||0),1),t("td",Me,[t("button",{class:"btn btn-small btn-primary",onClick:i=>oe(n)},"Recall",8,Te),t("button",{class:"btn btn-small btn-secondary",onClick:i=>le(n)},"Edit",8,Ne),t("button",{class:"btn btn-small btn-secondary",onClick:i=>ce(n)},"Values",8,Fe),t("button",{class:"btn btn-small btn-secondary",onClick:i=>de(n)},"Update",8,Ae),t("button",{class:"btn btn-small btn-danger",onClick:i=>ie(n)},"Delete",8,De)])])}),128)),h(b).scenes.length===0?(a(),s("tr",je,[...e[28]||(e[28]=[t("td",{colspan:"5",style:{"text-align":"center",color:"var(--text-secondary)",padding:"40px"}},' No scenes created yet. Click "+ New Scene" to create your first scene. ',-1)])])):p("",!0)])])]),J.value||y.value?(a(),s("div",Ee,[t("div",Je,[t("div",Pe,[t("h3",Be,v(y.value?"Edit Scene":"New Scene"),1),t("button",{class:"modal-close",onClick:j},"×")]),t("div",Re,[e[30]||(e[30]=t("label",{class:"form-label"},"Scene Name",-1)),_(t("input",{type:"text",class:"form-input","onUpdate:modelValue":e[0]||(e[0]=n=>u.value.name=n),placeholder:"e.g., Stage Wash"},null,512),[[V,u.value.name]])]),t("div",Le,[e[32]||(e[32]=t("label",{class:"form-label"},"Transition Type",-1)),_(t("select",{class:"form-select","onUpdate:modelValue":e[1]||(e[1]=n=>u.value.transition_type=n)},[...e[31]||(e[31]=[t("option",{value:"instant"},"Instant",-1),t("option",{value:"fade"},"Fade",-1),t("option",{value:"crossfade"},"Crossfade",-1)])],512),[[ge,u.value.transition_type]])]),u.value.transition_type!=="instant"?(a(),s("div",qe,[e[33]||(e[33]=t("label",{class:"form-label"},"Duration (ms)",-1)),_(t("input",{type:"number",class:"form-input","onUpdate:modelValue":e[2]||(e[2]=n=>u.value.duration=n),min:"0",step:"100",placeholder:"1000"},null,512),[[V,u.value.duration,void 0,{number:!0}]])])):p("",!0),y.value?p("",!0):(a(),s("div",ze,[e[34]||(e[34]=t("label",{class:"form-label"},"Universes to Capture",-1)),t("div",He,[t("button",{type:"button",class:"btn btn-small btn-secondary",onClick:e[3]||(e[3]=n=>m.value=h(d).map(o=>o.id))},"All"),t("button",{type:"button",class:"btn btn-small btn-secondary",onClick:e[4]||(e[4]=n=>m.value=[])},"None"),h(d).length>4?(a(),s("button",{key:0,type:"button",class:"btn btn-small btn-secondary",onClick:e[5]||(e[5]=n=>R("new"))},"Jump ▼")):p("",!0)]),t("div",Oe,[(a(!0),s(C,null,F(h(d),n=>(a(),s("label",{key:n.id,"data-universe-id":n.id,class:M(["universe-checkbox",{selected:m.value.includes(n.id)}])},[t("input",{type:"checkbox",checked:m.value.includes(n.id),onChange:o=>H(n.id,m.value)},null,40,Ie),t("span",We,v(n.label),1)],10,Ge))),128))]),m.value.length===0?(a(),s("p",Xe," Please select at least one universe ")):p("",!0)])),y.value?p("",!0):(a(),s("div",Ke,[...e[35]||(e[35]=[t("p",{style:{color:"var(--text-secondary)","font-size":"13px"}}," This will save the current fader values from the selected universe(s) as a new scene. ",-1)])])),t("div",Qe,[t("button",{type:"button",class:"btn btn-secondary",onClick:j},"Cancel"),t("button",{type:"button",class:"btn btn-primary",onClick:ae,disabled:!K.value},v(y.value?"Update":"Save Scene"),9,Ye)])])])):p("",!0),x.value?(a(),s("div",Ze,[t("div",et,[t("div",tt,[e[36]||(e[36]=t("h3",{class:"modal-title"},"Delete Scene",-1)),t("button",{class:"modal-close",onClick:e[6]||(e[6]=n=>x.value=null)},"×")]),e[37]||(e[37]=t("p",null,"Are you sure you want to delete this scene?",-1)),t("p",nt,v(x.value.name),1),t("div",lt,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[7]||(e[7]=n=>x.value=null)},"Cancel"),t("button",{type:"button",class:"btn btn-danger",onClick:ue},"Delete")])])])):p("",!0),w.value?(a(),s("div",st,[t("div",at,[t("div",ot,[e[38]||(e[38]=t("h3",{class:"modal-title"},"Update Scene Values",-1)),t("button",{class:"modal-close",onClick:e[8]||(e[8]=n=>w.value=null)},"×")]),t("p",null,'Update "'+v(w.value.name)+'" with current fader values?',1),t("div",it,[e[39]||(e[39]=t("label",{class:"form-label"},"Universes to Update",-1)),t("div",ut,[t("button",{type:"button",class:"btn btn-small btn-secondary",onClick:e[9]||(e[9]=n=>k.value=h(d).map(o=>o.id))},"All"),t("button",{type:"button",class:"btn btn-small btn-secondary",onClick:e[10]||(e[10]=n=>k.value=[])},"None"),h(d).length>4?(a(),s("button",{key:0,type:"button",class:"btn btn-small btn-secondary",onClick:e[11]||(e[11]=n=>R("update"))},"Jump ▼")):p("",!0)]),t("div",dt,[(a(!0),s(C,null,F(h(d),n=>(a(),s("label",{key:n.id,"data-universe-id":n.id,class:M(["universe-checkbox",{selected:k.value.includes(n.id)}])},[t("input",{type:"checkbox",checked:k.value.includes(n.id),onChange:o=>H(n.id,k.value)},null,40,ct),t("span",vt,v(n.label),1)],10,rt))),128))])]),t("div",pt,[e[42]||(e[42]=t("label",{class:"form-label"},"Update Mode",-1)),t("div",bt,[t("label",mt,[_(t("input",{type:"radio","onUpdate:modelValue":e[12]||(e[12]=n=>U.value=n),value:"replace_all"},null,512),[[G,U.value]]),e[40]||(e[40]=t("span",null,"Replace all values (remove other universes)",-1))]),t("label",yt,[_(t("input",{type:"radio","onUpdate:modelValue":e[13]||(e[13]=n=>U.value=n),value:"replace"},null,512),[[G,U.value]]),e[41]||(e[41]=t("span",null,"Merge (keep other universes, update selected)",-1))])])]),t("p",ft,[U.value==="replace_all"?(a(),s(C,{key:0},[I(" This will replace ALL scene values with values from the selected universe(s). ")],64)):(a(),s(C,{key:1},[I(" This will update only the selected universe(s), keeping existing values from other universes. ")],64))]),t("div",ht,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[14]||(e[14]=n=>w.value=null)},"Cancel"),t("button",{type:"button",class:"btn btn-primary",onClick:re,disabled:k.value.length===0},"Update Values",8,kt)])])])):p("",!0),$.value?(a(),s("div",_t,[t("div",gt,[t("div",Ct,[t("h3",St,"Edit Values - "+v($.value.name),1),t("button",{class:"modal-close",onClick:e[15]||(e[15]=n=>$.value=null)},"×")]),t("div",xt,[t("div",wt,[t("div",$t,[(a(!0),s(C,null,F(h(d),n=>(a(),s("button",{key:n.id,"data-universe-id":n.id,class:M(["universe-tab",{active:f.value===n.id}]),onClick:o=>f.value=n.id},v(n.label)+" ("+v(q(n.id))+") ",11,Ut))),128))]),t("div",Vt,[h(d).length>4?(a(),s("button",{key:0,type:"button",class:"btn btn-small btn-secondary",onClick:e[16]||(e[16]=n=>R("values"))},"Jump ▼")):p("",!0),t("button",{type:"button",class:"btn btn-small btn-danger",onClick:e[17]||(e[17]=n=>te(f.value)),disabled:q(f.value)===0}," Delete Universe ",8,Mt)])]),t("div",Tt,[t("div",Nt,[t("button",{class:M(["toggle-btn",{active:S.value==="add"}]),onClick:e[18]||(e[18]=n=>S.value="add")},"Add",2),t("button",{class:M(["toggle-btn",{active:S.value==="delete"}]),onClick:e[19]||(e[19]=n=>S.value="delete")},"Delete",2)]),e[44]||(e[44]=t("span",{class:"bulk-label"},"Ch",-1)),_(t("input",{type:"number",class:"form-input bulk-input","onUpdate:modelValue":e[20]||(e[20]=n=>T.value=n),min:"1",max:"512",placeholder:"Start"},null,512),[[V,T.value,void 0,{number:!0}]]),e[45]||(e[45]=t("span",null,"to",-1)),_(t("input",{type:"number",class:"form-input bulk-input","onUpdate:modelValue":e[21]||(e[21]=n=>N.value=n),min:"1",max:"512",placeholder:"End"},null,512),[[V,N.value,void 0,{number:!0}]]),S.value==="add"?(a(),s(C,{key:0},[e[43]||(e[43]=t("span",null,"@",-1)),_(t("input",{type:"number",class:"form-input bulk-input","onUpdate:modelValue":e[22]||(e[22]=n=>P.value=n),min:"0",max:"255",placeholder:"255"},null,512),[[V,P.value,void 0,{number:!0}]])],64)):p("",!0),t("button",{type:"button",class:M(["btn btn-small",S.value==="add"?"btn-primary":"btn-danger"]),onClick:ne,disabled:!T.value||!N.value},v(S.value==="add"?"Add":"Delete"),11,Ft)]),e[46]||(e[46]=t("div",{class:"values-header values-header-tabbed"},[t("span",null,"Channel"),t("span",null,"Value"),t("span")],-1)),t("div",At,[(a(!0),s(C,null,F(O(f.value),n=>(a(),s("div",{key:`${n.universe_id}-${n.channel}-${n.value}`,class:"value-row value-row-tabbed"},[_(t("input",{type:"number",class:"form-input","onUpdate:modelValue":o=>n.channel=o,min:"1",max:"512"},null,8,Dt),[[V,n.channel,void 0,{number:!0}]]),_(t("input",{type:"number",class:"form-input","onUpdate:modelValue":o=>n.value=o,min:"0",max:"255"},null,8,jt),[[V,n.value,void 0,{number:!0}]]),t("button",{type:"button",class:"btn btn-small btn-danger",onClick:o=>ee(n)},"X",8,Et)]))),128)),O(f.value).length===0?(a(),s("div",Jt,' No values for this universe. Click "+ Add Channel" to add. ')):p("",!0)]),t("button",{type:"button",class:"btn btn-small btn-secondary",onClick:e[23]||(e[23]=n=>Z(f.value)),style:{"margin-top":"8px"}}," + Add Channel ")]),t("div",Pt,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[24]||(e[24]=n=>$.value=null)},"Cancel"),t("button",{type:"button",class:"btn btn-primary",onClick:ve},"Save Values")])])])):p("",!0),A.value?(a(),s("div",{key:4,class:"modal-overlay",onClick:e[26]||(e[26]=Ce(n=>A.value=!1,["self"]))},[t("div",Bt,[t("div",Rt,[t("h4",null,v(D.value==="values"?"Jump to Universe":"Select Universe"),1),t("button",{class:"modal-close",onClick:e[25]||(e[25]=n=>A.value=!1)},"×")]),t("div",Lt,[(a(!0),s(C,null,F(h(d),n=>(a(),s("button",{key:n.id,class:M(["jump-popup-item",{selected:D.value==="new"?m.value.includes(n.id):D.value==="update"?k.value.includes(n.id):f.value===n.id}]),onClick:o=>Y(n.id)},v(n.label),11,qt))),128))])])])):p("",!0)]))}},Gt=be(zt,[["__scopeId","data-v-abb77e0d"]]);export{Gt as default};
