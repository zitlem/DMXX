import{_ as T,g as L,u as N,r as _,h as C,o as j,c as o,b as e,d as b,F as f,l as g,t as a,e as m,s as w,m as S,v as U,f as r}from"./index-BCRoANWK.js";const B={class:"card-header",style:{"margin-bottom":"16px"}},O={key:0,class:"overlap-warning"},H={class:"card"},W={class:"card-header"},z=["value"],G={class:"data-table"},I={class:"action-buttons"},J=["onClick"],q=["onClick"],K={key:0},Q={key:1,class:"modal-overlay"},R={class:"modal"},X={class:"modal-header"},Y={class:"modal-title"},Z={class:"form-group"},ee={class:"form-group"},te=["value"],le={class:"form-group"},ne=["value"],ae={class:"form-group"},se={class:"form-group"},oe={style:{display:"flex","align-items":"center",gap:"8px"}},re={key:0,class:"alert alert-error"},ue={class:"modal-footer"},ie=["disabled"],de={key:2,class:"modal-overlay"},ce={class:"modal"},ve={class:"modal-header"},pe={style:{color:"var(--text-secondary)"}},he={class:"modal-footer"},_e={__name:"PatchManager",setup(be){const u=L(),$=N(),y=_(null),x=_(!1),c=_(null),i=_(null),v=_(""),s=_({label:"",fixture_id:null,universe_id:null,start_channel:1,group_color:""}),k=C(()=>y.value===null?u.patches:u.patches.filter(n=>n.universe_id===y.value)),F=C(()=>s.value.fixture_id&&s.value.universe_id&&s.value.start_channel),A=C(()=>{const n=[],t=k.value;for(let l=0;l<t.length;l++)for(let d=l+1;d<t.length;d++){const p=t[l],h=t[d];p.universe_id===h.universe_id&&(p.end_channel<h.start_channel||p.start_channel>h.end_channel||n.push({patch1:p.label||p.fixture_name,patch2:h.label||h.fixture_name,range1:`${p.start_channel}-${p.end_channel}`,range2:`${h.start_channel}-${h.end_channel}`}))}return n});j(async()=>{await Promise.all([u.loadUniverses(),u.loadPatches(),u.loadFixtures()])});function D(n){c.value=n,s.value={label:n.label,fixture_id:n.fixture_id,universe_id:n.universe_id,start_channel:n.start_channel,group_color:n.group_color||""},v.value=""}function P(){x.value=!1,c.value=null,s.value={label:"",fixture_id:null,universe_id:null,start_channel:1,group_color:""},v.value=""}async function V(){v.value="";try{const n=c.value?`/api/patch/${c.value.id}`:"/api/patch",t=c.value?"PUT":"POST",l=await fetch(n,{method:t,headers:{"Content-Type":"application/json",...$.getAuthHeaders()},body:JSON.stringify(s.value)});if(l.ok)await u.loadPatches(),P();else{const d=await l.json();v.value=d.detail||"Failed to save patch"}}catch{v.value="Failed to save patch"}}function E(n){i.value=n}async function M(){try{await fetch(`/api/patch/${i.value.id}`,{method:"DELETE",headers:$.getAuthHeaders()}),await u.loadPatches()}catch(n){console.error("Failed to delete patch:",n)}i.value=null}return(n,t)=>(r(),o("div",null,[e("div",B,[t[10]||(t[10]=e("h2",{class:"card-title"},"Patch Manager",-1)),e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=l=>x.value=!0)},"+ Add Patch")]),A.value.length>0?(r(),o("div",O,[t[11]||(t[11]=e("strong",null,"Channel Overlap Warning:",-1)),e("ul",null,[(r(!0),o(f,null,g(A.value,(l,d)=>(r(),o("li",{key:d},a(l.patch1)+" ("+a(l.range1)+") overlaps with "+a(l.patch2)+" ("+a(l.range2)+") ",1))),128))])])):b("",!0),e("div",H,[e("div",W,[t[13]||(t[13]=e("h3",{class:"card-title"},"Patches",-1)),m(e("select",{class:"form-select",style:{width:"auto"},"onUpdate:modelValue":t[1]||(t[1]=l=>y.value=l)},[t[12]||(t[12]=e("option",{value:null},"All Universes",-1)),(r(!0),o(f,null,g(S(u).universes,l=>(r(),o("option",{key:l.id,value:l.id},a(l.label),9,z))),128))],512),[[w,y.value]])]),e("table",G,[t[15]||(t[15]=e("thead",null,[e("tr",null,[e("th",null,"Label"),e("th",null,"Fixture"),e("th",null,"Universe"),e("th",null,"Channels"),e("th",null,"Actions")])],-1)),e("tbody",null,[(r(!0),o(f,null,g(k.value,l=>(r(),o("tr",{key:l.id},[e("td",null,a(l.label||"-"),1),e("td",null,a(l.fixture_name),1),e("td",null,a(l.universe_label),1),e("td",null,a(l.start_channel)+"-"+a(l.end_channel),1),e("td",I,[e("button",{class:"btn btn-small btn-secondary",onClick:d=>D(l)},"Edit",8,J),e("button",{class:"btn btn-small btn-danger",onClick:d=>E(l)},"Delete",8,q)])]))),128)),k.value.length===0?(r(),o("tr",K,[...t[14]||(t[14]=[e("td",{colspan:"5",style:{"text-align":"center",color:"var(--text-secondary)"}}," No patches configured ",-1)])])):b("",!0)])])]),x.value||c.value?(r(),o("div",Q,[e("div",R,[e("div",X,[e("h3",Y,a(c.value?"Edit Patch":"Add Patch"),1),e("button",{class:"modal-close",onClick:P},"×")]),e("div",Z,[t[16]||(t[16]=e("label",{class:"form-label"},"Label (optional)",-1)),m(e("input",{type:"text",class:"form-input","onUpdate:modelValue":t[2]||(t[2]=l=>s.value.label=l),placeholder:"e.g., Front Wash 1"},null,512),[[U,s.value.label]])]),e("div",ee,[t[18]||(t[18]=e("label",{class:"form-label"},"Fixture",-1)),m(e("select",{class:"form-select","onUpdate:modelValue":t[3]||(t[3]=l=>s.value.fixture_id=l)},[t[17]||(t[17]=e("option",{value:null},"Select fixture...",-1)),(r(!0),o(f,null,g(S(u).fixtures,l=>(r(),o("option",{key:l.id,value:l.id},a(l.name)+" ("+a(l.channel_count)+" ch) ",9,te))),128))],512),[[w,s.value.fixture_id]])]),e("div",le,[t[20]||(t[20]=e("label",{class:"form-label"},"Universe",-1)),m(e("select",{class:"form-select","onUpdate:modelValue":t[4]||(t[4]=l=>s.value.universe_id=l)},[t[19]||(t[19]=e("option",{value:null},"Select universe...",-1)),(r(!0),o(f,null,g(S(u).universes,l=>(r(),o("option",{key:l.id,value:l.id},a(l.label),9,ne))),128))],512),[[w,s.value.universe_id]])]),e("div",ae,[t[21]||(t[21]=e("label",{class:"form-label"},"Start Channel",-1)),m(e("input",{type:"number",class:"form-input","onUpdate:modelValue":t[5]||(t[5]=l=>s.value.start_channel=l),min:"1",max:"512"},null,512),[[U,s.value.start_channel,void 0,{number:!0}]])]),e("div",se,[t[23]||(t[23]=e("label",{class:"form-label"},"Group Color",-1)),e("div",oe,[m(e("input",{type:"color","onUpdate:modelValue":t[6]||(t[6]=l=>s.value.group_color=l),style:{width:"50px",height:"32px",border:"none",cursor:"pointer"}},null,512),[[U,s.value.group_color]]),t[22]||(t[22]=e("span",{style:{"font-size":"11px",color:"var(--text-secondary)"}},"Stripe at bottom of faders to group this patch",-1)),s.value.group_color?(r(),o("button",{key:0,class:"btn btn-small btn-secondary",onClick:t[7]||(t[7]=l=>s.value.group_color=""),style:{padding:"2px 6px"}},"Clear")):b("",!0)])]),v.value?(r(),o("div",re,a(v.value),1)):b("",!0),e("div",ue,[e("button",{class:"btn btn-secondary",onClick:P},"Cancel"),e("button",{class:"btn btn-primary",onClick:V,disabled:!F.value},a(c.value?"Update":"Add"),9,ie)])])])):b("",!0),i.value?(r(),o("div",de,[e("div",ce,[e("div",ve,[t[24]||(t[24]=e("h3",{class:"modal-title"},"Delete Patch",-1)),e("button",{class:"modal-close",onClick:t[8]||(t[8]=l=>i.value=null)},"×")]),t[25]||(t[25]=e("p",null,"Are you sure you want to delete this patch?",-1)),e("p",pe,a(i.value.fixture_name)+" @ "+a(i.value.universe_label)+" Ch "+a(i.value.start_channel),1),e("div",he,[e("button",{class:"btn btn-secondary",onClick:t[9]||(t[9]=l=>i.value=null)},"Cancel"),e("button",{class:"btn btn-danger",onClick:M},"Delete")])])])):b("",!0)]))}},fe=T(_e,[["__scopeId","data-v-0236301d"]]);export{fe as default};
